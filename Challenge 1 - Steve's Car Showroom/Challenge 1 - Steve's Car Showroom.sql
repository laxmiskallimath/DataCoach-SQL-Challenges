-- Date : 24/02/2024
-- Solution by : Laxmi S Kallimath
-- Challenge by : DataCoach

-- Challenge 1 - Steve's Car Showroom

CREATE database car_showroom;
USE car_showroom;

-- Lets create required tables 

CREATE TABLE cars (
car_id INT PRIMARY KEY,
make VARCHAR(50),
type VARCHAR(50),
style VARCHAR(50),
cost_$ INT
);

INSERT INTO cars (car_id, make, type, style, cost_$)
VALUES (1, 'Honda', 'Civic', 'Sedan', 30000),
(2, 'Toyota', 'Corolla', 'Hatchback', 25000),
(3, 'Ford', 'Explorer', 'SUV', 40000),
(4, 'Chevrolet', 'Camaro', 'Coupe', 36000),
(5, 'BMW', 'X5', 'SUV', 55000),
(6, 'Audi', 'A4', 'Sedan', 48000),
(7, 'Mercedes', 'C-Class', 'Coupe', 60000),
(8, 'Nissan', 'Altima', 'Sedan', 26000);

SELECT * FROM cars;
--------------------
CREATE TABLE salespersons (
salesman_id INT PRIMARY KEY,
name VARCHAR(50),
age INT,
city VARCHAR(50)
);

INSERT INTO salespersons (salesman_id, name, age, city)
VALUES (1, 'John Smith', 28, 'New York'),
(2, 'Emily Wong', 35, 'San Fran'),
(3, 'Tom Lee', 42, 'Seattle'),
(4, 'Lucy Chen', 31, 'LA');

SELECT * FROM salespersons;
--------------------
CREATE TABLE sales (
sale_id INT PRIMARY KEY,
car_id INT,
salesman_id INT,
purchase_date DATE,
FOREIGN KEY (car_id) REFERENCES cars(car_id),
FOREIGN KEY (salesman_id) REFERENCES salespersons(salesman_id)
);
 
INSERT INTO sales (sale_id, car_id, salesman_id, purchase_date)
VALUES (1, 1, 1, '2021-01-01'),
(2, 3, 3, '2021-02-03'),
(3, 2, 2, '2021-02-10'),
(4, 5, 4, '2021-03-01'),
(5, 8, 1, '2021-04-02'),
(6, 2, 1, '2021-05-05'),
(7, 4, 2, '2021-06-07'),
(8, 5, 3, '2021-07-09'),
(9, 2, 4, '2022-01-01'),
(10, 1, 3, '2022-02-03'),
(11, 8, 2, '2022-02-10'),
(12, 7, 2, '2022-03-01'),
(13, 5, 3, '2022-04-02'),
(14, 3, 1, '2022-05-05'),
(15, 5, 4, '2022-06-07'),
(16, 1, 2, '2022-07-09'),
(17, 2, 3, '2023-01-01'),
(18, 6, 3, '2023-02-03'),
(19, 7, 1, '2023-02-10'),
(20, 4, 4, '2023-03-01');

SELECT * FROM SALES;

-- Questions

-- 1. What are the details of all cars purchased in the year 2022?
SELECT 
	C1.car_id,
     make,
     type,
     style,
     cost_$,
     purchase_date
FROM 
    SALES AS S1
JOIN 
     CARS AS C1
ON 
     S1.car_id = C1.car_id
WHERE 
     YEAR(purchase_date) = '2022'
ORDER BY purchase_date DESC;

-- RESULTS
/*car_id,     make,      type,     style,       cost_$,      purchase_date
    1	        Honda	     Civic	   Sedan	       30000	        2022-07-09
    5        	BMW	       X5	        SUV	         55000	        2022-06-07
    3	        Ford	     Explorer   SUV	         40000	        2022-05-05
    5       	BMW        X5	        SUV	         55000	        2022-04-02
    7	        Mercedes   C-Class    Coupe	       60000	        2022-03-01
    8	        Nissan	   Altima	     Sedan	     26000	        2022-02-10
    1	        Honda	     Civic	     Sedan	     30000	        2022-02-03
    2	        Toyota	   Corolla	   Hatchback	 25000	        2022-01-01*/

-- 2. What is the total number of cars sold by each salesperson?
SELECT 
      name as salesperson,
      COUNT(S1.sale_id) AS cars_sold
FROM 
    sales S1
JOIN 
    salespersons S2
ON S1.salesman_id = S2.salesman_id
GROUP BY 
      S2.salesman_id
ORDER BY 
   cars_sold DESC;

 -- RESULTS
 /*
salesperson  cars_sold
Emily Wong	  5
John Smith	  5
Lucy Chen	    4
Tom Lee	      6
*/
 
-- 3. What is the total revenue generated by each salesperson?
SELECT 
      name as salesman_name,
      SUM(cost_$) AS total_revenue
FROM 
	sales S1
JOIN
    cars C1
ON  
    S1.car_id = C1.car_id
JOIN 
    salespersons S2
ON 
    S1.salesman_id = S2.salesman_id
GROUP BY
    S2.salesman_id
ORDER BY 
     total_revenue DESC;

-- RESULTS
/*
salesman_name   total_revenue
Tom Lee	         253000
John Smith	     181000
Emily Wong	     177000
Lucy Chen	       171000
*/

-- 4. What are the details of the cars sold by each salesperson?
SELECT 
      name as salesman_name,
      S1.car_id,
      make,
      type,
      style,
      cost_$,
      purchase_date
FROM 
    sales S1
JOIN
    cars c1
ON 
  S1.car_id = c1.car_id
JOIN
   salespersons S2
ON 
   S2. salesman_id  = S2.salesman_id
ORDER BY 
   salesman_name,
   purchase_date DESC;
   
-- RESULTS
/*
salesman_name, car_id, make,   type,        style, cost_$, purchase_date
Emily Wong	     4	   Chevrolet	Camaro	Coupe	36000	2023-03-01
Emily Wong	7	Mercedes	C-Class	Coupe	60000	2023-02-10
Emily Wong	6	Audi	A4	Sedan	48000	2023-02-03
Emily Wong	2	Toyota	Corolla	Hatchback	25000	2023-01-01
Emily Wong	1	Honda	Civic	Sedan	30000	2022-07-09
Emily Wong	5	BMW	X5	SUV	55000	2022-06-07
Emily Wong	3	Ford	Explorer	SUV	40000	2022-05-05
Emily Wong	5	BMW	X5	SUV	55000	2022-04-02
Emily Wong	7	Mercedes	C-Class	Coupe	60000	2022-03-01
Emily Wong	8	Nissan	Altima	Sedan	26000	2022-02-10
Emily Wong	1	Honda	Civic	Sedan	30000	2022-02-03
Emily Wong	2	Toyota	Corolla	Hatchback	25000	2022-01-01
Emily Wong	5	BMW	X5	SUV	55000	2021-07-09
Emily Wong	4	Chevrolet	Camaro	Coupe	36000	2021-06-07
Emily Wong	2	Toyota	Corolla	Hatchback	25000	2021-05-05
Emily Wong	8	Nissan	Altima	Sedan	26000	2021-04-02
Emily Wong	5	BMW	X5	SUV	55000	2021-03-01
Emily Wong	2	Toyota	Corolla	Hatchback	25000	2021-02-10
Emily Wong	3	Ford	Explorer	SUV	40000	2021-02-03
Emily Wong	1	Honda	Civic	Sedan	30000	2021-01-01
John Smith	4	Chevrolet	Camaro	Coupe	36000	2023-03-01
John Smith	7	Mercedes	C-Class	Coupe	60000	2023-02-10
John Smith	6	Audi	A4	Sedan	48000	2023-02-03
John Smith	2	Toyota	Corolla	Hatchback	25000	2023-01-01
John Smith	1	Honda	Civic	Sedan	30000	2022-07-09
John Smith	5	BMW	X5	SUV	55000	2022-06-07
John Smith	3	Ford	Explorer	SUV	40000	2022-05-05
John Smith	5	BMW	X5	SUV	55000	2022-04-02
John Smith	7	Mercedes	C-Class	Coupe	60000	2022-03-01
John Smith	8	Nissan	Altima	Sedan	26000	2022-02-10
John Smith	1	Honda	Civic	Sedan	30000	2022-02-03
John Smith	2	Toyota	Corolla	Hatchback	25000	2022-01-01
John Smith	5	BMW	X5	SUV	55000	2021-07-09
John Smith	4	Chevrolet	Camaro	Coupe	36000	2021-06-07
John Smith	2	Toyota	Corolla	Hatchback	25000	2021-05-05
John Smith	8	Nissan	Altima	Sedan	26000	2021-04-02
John Smith	5	BMW	X5	SUV	55000	2021-03-01
John Smith	2	Toyota	Corolla	Hatchback	25000	2021-02-10
John Smith	3	Ford	Explorer	SUV	40000	2021-02-03
John Smith	1	Honda	Civic	Sedan	30000	2021-01-01
Lucy Chen	4	Chevrolet	Camaro	Coupe	36000	2023-03-01
Lucy Chen	7	Mercedes	C-Class	Coupe	60000	2023-02-10
Lucy Chen	6	Audi	A4	Sedan	48000	2023-02-03
Lucy Chen	2	Toyota	Corolla	Hatchback	25000	2023-01-01
Lucy Chen	1	Honda	Civic	Sedan	30000	2022-07-09
Lucy Chen	5	BMW	X5	SUV	55000	2022-06-07
Lucy Chen	3	Ford	Explorer	SUV	40000	2022-05-05
Lucy Chen	5	BMW	X5	SUV	55000	2022-04-02
Lucy Chen	7	Mercedes	C-Class	Coupe	60000	2022-03-01
Lucy Chen	8	Nissan	Altima	Sedan	26000	2022-02-10
Lucy Chen	1	Honda	Civic	Sedan	30000	2022-02-03
Lucy Chen	2	Toyota	Corolla	Hatchback	25000	2022-01-01
Lucy Chen	5	BMW	X5	SUV	55000	2021-07-09
Lucy Chen	4	Chevrolet	Camaro	Coupe	36000	2021-06-07
Lucy Chen	2	Toyota	Corolla	Hatchback	25000	2021-05-05
Lucy Chen	8	Nissan	Altima	Sedan	26000	2021-04-02
Lucy Chen	5	BMW	X5	SUV	55000	2021-03-01
Lucy Chen	2	Toyota	Corolla	Hatchback	25000	2021-02-10
Lucy Chen	3	Ford	Explorer	SUV	40000	2021-02-03
Lucy Chen	1	Honda	Civic	Sedan	30000	2021-01-01
Tom Lee	4	Chevrolet	Camaro	Coupe	36000	2023-03-01
Tom Lee	7	Mercedes	C-Class	Coupe	60000	2023-02-10
Tom Lee	6	Audi	A4	Sedan	48000	2023-02-03
Tom Lee	2	Toyota	Corolla	Hatchback	25000	2023-01-01
Tom Lee	1	Honda	Civic	Sedan	30000	2022-07-09
Tom Lee	5	BMW	X5	SUV	55000	2022-06-07
Tom Lee	3	Ford	Explorer	SUV	40000	2022-05-05
Tom Lee	5	BMW	X5	SUV	55000	2022-04-02
Tom Lee	7	Mercedes	C-Class	Coupe	60000	2022-03-01
Tom Lee	8	Nissan	Altima	Sedan	26000	2022-02-10
Tom Lee	1	Honda	Civic	Sedan	30000	2022-02-03
Tom Lee	2	Toyota	Corolla	Hatchback	25000	2022-01-01
Tom Lee	5	BMW	X5	SUV	55000	2021-07-09
Tom Lee	4	Chevrolet	Camaro	Coupe	36000	2021-06-07
Tom Lee	2	Toyota	Corolla	Hatchback	25000	2021-05-05
Tom Lee	8	Nissan	Altima	Sedan	26000	2021-04-02
Tom Lee	5	BMW	X5	SUV	55000	2021-03-01
Tom Lee	2	Toyota	Corolla	Hatchback	25000	2021-02-10
Tom Lee	3	Ford	Explorer	SUV	40000	2021-02-03
Tom Lee	1	Honda	Civic	Sedan	30000	2021-01-01
*/


-- 5. What is the total revenue generated by each car type?
SELECT
   type AS car_type,
   SUM(cost_$ ) AS total_revenue 
FROM
   sales S1
JOIN
   cars C1 
ON 
    S1.car_id = C1.car_id 
GROUP BY
   type 
ORDER BY
   total_revenue DESC;
 
-- RESULTS
/*
car_type      total_revenue
X5	          220000
C-Class	      120000
Corolla	      100000
Civic	        90000
Explorer	    80000
Camaro	      72000
Altima	      52000
A4	          48000
*/

-- 6. What are the details of the cars sold in the year 2021 by salesperson 'Emily Wong'?
SELECT
   sale_id,
   purchase_date,
   S1.car_id,
   make,
   type,
   style,
   cost_$ 
FROM
   sales S1 
   JOIN
      cars C1
      ON S1.car_id = C1.car_id 
   JOIN
      salespersons S2 
      ON S1.salesman_id = S2.salesman_id 
WHERE
   YEAR(purchase_date) = '2021' 
   AND name = 'Emily Wong' 
ORDER BY
   purchase_date DESC;

-- RESULTS
/*
sale_id, purchase_date, car_id, make,       type,     style,     cost_$
7	      2021-06-07	     4	    Chevrolet	  Camaro	  Coupe	     36000
3	      2021-02-10	     2	    Toyota	    Corolla	  Hatchback	 25000
*/


-- 7. What is the total revenue generated by the sales of hatchback cars?
SELECT
   style,
   SUM(cost_$ ) AS total_revenue 
FROM
   sales S1 
JOIN
      cars C1
ON
      S1.car_id = C1.car_id 
WHERE
     style = 'Hatchback' 
GROUP BY
     style;
   
-- RESULT
/*
style       total_revenue
Hatchback	   100000
*/

-- 8. What is the total revenue generated by the sales of SUV cars in the year 2022?
SELECT
   style,
   SUM(cost_$ ) AS total_revenue 
FROM
   sales S1
   JOIN
      cars C1
      ON 
      S1.car_id = C1.car_id 
WHERE
   style = 'SUV' 
   AND YEAR(purchase_date) = '2022' 
GROUP BY
   style;

-- RESULT
/*
style   total_revenue
SUV	     150000
*/

-- 9. What is the name and city of the salesperson who sold the most number of cars in the year 2023?
WITH most_number_of_cars_sold AS
(
   SELECT
      name,
      city,
      COUNT(name) AS cars_sold,
      RANK() OVER (ORDER BY COUNT(name) DESC ) AS rankk 
   FROM
      sales S1
      JOIN
         salespersons S2 
         ON
           S1.salesman_id = S2.salesman_id 
   WHERE
      YEAR(purchase_date) = '2023' 
   GROUP BY
      name,
      city 
   ORDER BY
      cars_sold DESC
)
SELECT
   name AS salesman,
   city,
   cars_sold 
FROM
   most_number_of_cars_sold 
WHERE
   rankk = 1;

-- RESULT
/*
salesman    city     cars_sold
Tom Lee	   Seattle	 2
*/

-- 10. What is the name and age of the salesperson who generated the highest revenue in the year 2022?
WITH salesman_with_highest_revenue AS
(
   SELECT
      salesman_id,
      SUM(cost_$ ) AS total_revenue,
      RANK() OVER (ORDER BY SUM(cost_$ ) DESC) AS rankk 
   FROM
      sales S1
      JOIN
         cars C1
         ON S1.car_id = C1.car_id 
   WHERE
      YEAR(purchase_date) = '2022' 
   GROUP BY
      salesman_id 
   ORDER BY
      total_revenue DESC
)
SELECT
   name AS salesperson,
   age,
   total_revenue 
FROM
   salesman_with_highest_revenue SWHR
   JOIN
      salespersons S2
      ON SWHR.salesman_id = S2.salesman_id 
WHERE
   rankk = 1;
 
 /*
 salesperson  age total_revenue  
  Emily Wong	35	116000 
   */
